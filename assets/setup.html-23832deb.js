import{_ as c,M as l,p as i,q as u,R as n,N as a,U as e,t as s,a1 as o}from"./framework-efe98465.js";const r={},k=n("h1",{id:"setup",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#setup","aria-hidden":"true"},"#"),s(" Setup")],-1),d=n("p",null,"The database adapter is written such that it can be used within a regular Laravel application, as well as outside Laravel.",-1),v={class:"table-of-contents"},g=o(`<h2 id="inside-laravel-application" tabindex="-1"><a class="header-anchor" href="#inside-laravel-application" aria-hidden="true">#</a> Inside Laravel Application</h2><h3 id="register-service-provider" tabindex="-1"><a class="header-anchor" href="#register-service-provider" aria-hidden="true">#</a> Register Service Provider</h3><p>Register <code>FlysystemDatabaseAdapterServiceProvider</code> inside your <code>config/app.php</code>.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token punctuation">[</span>

    <span class="token comment">// ... previous not shown ... //</span>

    <span class="token comment">/*
    |--------------------------------------------------------------------------
    | Autoloaded Service Providers
    |--------------------------------------------------------------------------
    */</span>

    <span class="token string single-quoted-string">&#39;providers&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>

        <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\\</span>Aedart<span class="token punctuation">\\</span>Flysystem<span class="token punctuation">\\</span>Db<span class="token punctuation">\\</span>Providers<span class="token punctuation">\\</span>FlysystemDatabaseAdapterServiceProvider</span><span class="token operator">::</span><span class="token keyword">class</span>

        <span class="token comment">// ... remaining services not shown ... //</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="create-custom-migration" tabindex="-1"><a class="header-anchor" href="#create-custom-migration" aria-hidden="true">#</a> Create custom migration</h3><p>The database adapter will require two tables to be migrated. To do so, run the following command and follow the on-screen instructions:</p><div class="language-console line-numbers-mode" data-ext="console"><pre class="language-console"><code>php artisan flysystem:make-adapter-migration
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The command will generate a new migration file, with the specified table names. Once completed, migrate your database:</p><div class="language-console line-numbers-mode" data-ext="console"><pre class="language-console"><code>php artisan migrate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="add-storage-disk-profile" tabindex="-1"><a class="header-anchor" href="#add-storage-disk-profile" aria-hidden="true">#</a> Add storage disk &quot;profile&quot;</h3><p>In your <code>config/filesystems.php</code>, add a new storage disk profile, which uses <code>database</code> as its driver: The followings shows a custom disk that uses the database driver and has <code>my_disk</code> as &quot;profile&quot; name.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token punctuation">[</span>

    <span class="token comment">// ...previous not shown...</span>

    <span class="token comment">/*
    |--------------------------------------------------------------------------
    | Filesystem Disks
    |--------------------------------------------------------------------------
    */</span>

    <span class="token string single-quoted-string">&#39;disks&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>

        <span class="token comment">// ...previous not shown...</span>

        <span class="token string single-quoted-string">&#39;my_disk&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">&#39;driver&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;database&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;connection&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;DB_CONNECTION&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;mysql&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;files_table&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;files&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;contents_table&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;files_contents&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;hash_algo&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;sha256&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;path_prefix&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="use-storage-disk" tabindex="-1"><a class="header-anchor" href="#use-storage-disk" aria-hidden="true">#</a> Use storage disk</h3><p>To use the custom disk profile, use the <code>disk()</code> method on the <code>Storage</code> facade.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Support<span class="token punctuation">\\</span>Facades<span class="token punctuation">\\</span>Storage</span><span class="token punctuation">;</span>
 
<span class="token class-name static-context">Storage</span><span class="token operator">::</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;my_disk&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;example.txt&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;Contents&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,15),m={href:"https://laravel.com/docs/9.x/filesystem",target:"_blank",rel:"noopener noreferrer"},b=n("h2",{id:"outside-laravel",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#outside-laravel","aria-hidden":"true"},"#"),s(" Outside Laravel")],-1),y={href:"https://packagist.org/packages/illuminate/database",target:"_blank",rel:"noopener noreferrer"},q=n("code",null,"Manager",-1),h=o('<p>Choose your database driver and create the required tables. Feel free to change the table names to whatever you see fit.</p><div class="custom-container tip"><p class="custom-container-title">SQL Generator</p><p>The shown SQL is generated via a small binary helper in this package.</p><p>Run <code>./vendor/aedart/athenaeum-flysystem-db/bin/table_schemas</code>.</p></div><h3 id="sqlite" tabindex="-1"><a class="header-anchor" href="#sqlite" aria-hidden="true">#</a> SQLite</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span> <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> autoincrement<span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span> <span class="token keyword">varchar</span> <span class="token keyword">check</span> <span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">&#39;dir&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;path&quot;</span> <span class="token keyword">varchar</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;level&quot;</span> <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;file_size&quot;</span> <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;mime_type&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span> <span class="token string">&quot;visibility&quot;</span> <span class="token keyword">varchar</span> <span class="token keyword">check</span> <span class="token punctuation">(</span><span class="token string">&quot;visibility&quot;</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">&#39;public&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;private&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;private&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;content_hash&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span> <span class="token string">&quot;last_modified&quot;</span> <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;extra_metadata&quot;</span> <span class="token keyword">text</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">index</span> <span class="token string">&quot;files_path_index&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">index</span> <span class="token string">&quot;files_path_level_index&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;level&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">index</span> <span class="token string">&quot;files_content_hash_index&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;content_hash&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> <span class="token string">&quot;files_path_unique&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token string">&quot;file_contents&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span> <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> autoincrement<span class="token punctuation">,</span> <span class="token string">&quot;hash&quot;</span> <span class="token keyword">varchar</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;reference_count&quot;</span> <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;contents&quot;</span> <span class="token keyword">blob</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">index</span> <span class="token string">&quot;file_contents_hash_index&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;file_contents&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> <span class="token string">&quot;file_contents_hash_unique&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;file_contents&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mysql-mariadb" tabindex="-1"><a class="header-anchor" href="#mysql-mariadb" aria-hidden="true">#</a> MySQL / MariaDB</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>files<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token keyword">unsigned</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>type<span class="token punctuation">`</span></span> <span class="token keyword">enum</span><span class="token punctuation">(</span><span class="token string">&#39;dir&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;file&#39;</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;Whether this is a file or directory&#39;</span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>path<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;Unique path of file or directory&#39;</span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>level<span class="token punctuation">`</span></span> <span class="token keyword">smallint</span> <span class="token keyword">unsigned</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">comment</span> <span class="token string">&#39;Depth level&#39;</span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>file_size<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">comment</span> <span class="token string">&#39;Filesize in bytes&#39;</span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>mime_type<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;File media type / mimetype&#39;</span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>visibility<span class="token punctuation">`</span></span> <span class="token keyword">enum</span><span class="token punctuation">(</span><span class="token string">&#39;public&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;private&#39;</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;private&#39;</span> <span class="token keyword">comment</span> <span class="token string">&#39;File or directory visibility&#39;</span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>content_hash<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;Hash of file content&#39;</span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>last_modified<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">comment</span> <span class="token string">&#39;Unix timestamp of when file or directory was last modified&#39;</span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>extra_metadata<span class="token punctuation">`</span></span> json <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;Evt. custom extra meta data about file or directory&#39;</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">character</span> <span class="token keyword">set</span> utf8mb4 <span class="token keyword">collate</span> <span class="token string">&#39;utf8mb4_unicode_ci&#39;</span>\n\n<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>files<span class="token punctuation">`</span></span> <span class="token keyword">add</span> <span class="token keyword">index</span> <span class="token identifier"><span class="token punctuation">`</span>files_path_index<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>path<span class="token punctuation">`</span></span><span class="token punctuation">)</span>\n\n<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>files<span class="token punctuation">`</span></span> <span class="token keyword">add</span> <span class="token keyword">index</span> <span class="token identifier"><span class="token punctuation">`</span>files_path_level_index<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>path<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>level<span class="token punctuation">`</span></span><span class="token punctuation">)</span>\n\n<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>files<span class="token punctuation">`</span></span> <span class="token keyword">add</span> <span class="token keyword">index</span> <span class="token identifier"><span class="token punctuation">`</span>files_content_hash_index<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>content_hash<span class="token punctuation">`</span></span><span class="token punctuation">)</span>\n\n<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>files<span class="token punctuation">`</span></span> <span class="token keyword">add</span> <span class="token keyword">unique</span> <span class="token identifier"><span class="token punctuation">`</span>files_path_unique<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>path<span class="token punctuation">`</span></span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>file_contents<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token keyword">unsigned</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>hash<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;Hash of file content&#39;</span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>reference_count<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">comment</span> <span class="token string">&#39;Amount of files that references this content&#39;</span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>contents<span class="token punctuation">`</span></span> <span class="token keyword">blob</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;File contents&#39;</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">character</span> <span class="token keyword">set</span> utf8mb4 <span class="token keyword">collate</span> <span class="token string">&#39;utf8mb4_unicode_ci&#39;</span>\n\n<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>file_contents<span class="token punctuation">`</span></span> <span class="token keyword">add</span> <span class="token keyword">index</span> <span class="token identifier"><span class="token punctuation">`</span>file_contents_hash_index<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>hash<span class="token punctuation">`</span></span><span class="token punctuation">)</span>\n\n<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>file_contents<span class="token punctuation">`</span></span> <span class="token keyword">add</span> <span class="token keyword">unique</span> <span class="token identifier"><span class="token punctuation">`</span>file_contents_hash_unique<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>hash<span class="token punctuation">`</span></span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="postgresql" tabindex="-1"><a class="header-anchor" href="#postgresql" aria-hidden="true">#</a> PostgreSQL</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span> bigserial <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">check</span> <span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">&#39;dir&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;path&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;level&quot;</span> <span class="token keyword">smallint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;file_size&quot;</span> <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;mime_type&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;visibility&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">check</span> <span class="token punctuation">(</span><span class="token string">&quot;visibility&quot;</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">&#39;public&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;private&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;private&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;content_hash&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;last_modified&quot;</span> <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;extra_metadata&quot;</span> json <span class="token boolean">null</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">index</span> <span class="token string">&quot;files_path_index&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">index</span> <span class="token string">&quot;files_path_level_index&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;level&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">index</span> <span class="token string">&quot;files_content_hash_index&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;content_hash&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token string">&quot;files&quot;</span> <span class="token keyword">add</span> <span class="token keyword">constraint</span> <span class="token string">&quot;files_path_unique&quot;</span> <span class="token keyword">unique</span> <span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token string">&quot;file_contents&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span> bigserial <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;hash&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;reference_count&quot;</span> <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;contents&quot;</span> bytea <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">index</span> <span class="token string">&quot;file_contents_hash_index&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;file_contents&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token string">&quot;file_contents&quot;</span> <span class="token keyword">add</span> <span class="token keyword">constraint</span> <span class="token string">&quot;file_contents_hash_unique&quot;</span> <span class="token keyword">unique</span> <span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sql-server" tabindex="-1"><a class="header-anchor" href="#sql-server" aria-hidden="true">#</a> SQL Server</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span> <span class="token keyword">bigint</span> <span class="token keyword">identity</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span> nvarchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">check</span> <span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span> <span class="token operator">in</span> <span class="token punctuation">(</span>N<span class="token string">&#39;dir&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;path&quot;</span> nvarchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;level&quot;</span> <span class="token keyword">smallint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;file_size&quot;</span> <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;mime_type&quot;</span> nvarchar<span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;visibility&quot;</span> nvarchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">check</span> <span class="token punctuation">(</span><span class="token string">&quot;visibility&quot;</span> <span class="token operator">in</span> <span class="token punctuation">(</span>N<span class="token string">&#39;public&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;private&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;private&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;content_hash&quot;</span> nvarchar<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;last_modified&quot;</span> <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;extra_metadata&quot;</span> nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">index</span> <span class="token string">&quot;files_path_index&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">index</span> <span class="token string">&quot;files_path_level_index&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;level&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">index</span> <span class="token string">&quot;files_content_hash_index&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;content_hash&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> <span class="token string">&quot;files_path_unique&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;files&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token string">&quot;file_contents&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span> <span class="token keyword">bigint</span> <span class="token keyword">identity</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;hash&quot;</span> nvarchar<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&quot;reference_count&quot;</span> <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;contents&quot;</span> <span class="token keyword">varbinary</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">index</span> <span class="token string">&quot;file_contents_hash_index&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;file_contents&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> <span class="token string">&quot;file_contents_hash_unique&quot;</span> <span class="token keyword">on</span> <span class="token string">&quot;file_contents&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="new-adapter-instance" tabindex="-1"><a class="header-anchor" href="#new-adapter-instance" aria-hidden="true">#</a> New Adapter Instance</h3>',11),w={href:"https://github.com/laravel/laravel/blob/9.x/config/database.php",target:"_blank",rel:"noopener noreferrer"},f=o(`<div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Aedart<span class="token punctuation">\\</span>Flysystem<span class="token punctuation">\\</span>Db<span class="token punctuation">\\</span>Adapters<span class="token punctuation">\\</span>DatabaseAdapter</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Database<span class="token punctuation">\\</span>Capsule<span class="token punctuation">\\</span>Manager</span> <span class="token keyword">as</span> Capsule<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">League<span class="token punctuation">\\</span>Flysystem<span class="token punctuation">\\</span>Filesystem</span><span class="token punctuation">;</span>

<span class="token comment">// Establish database connection</span>
<span class="token variable">$capsule</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Capsule</span><span class="token punctuation">;</span>
<span class="token variable">$capsule</span><span class="token operator">-&gt;</span><span class="token function">addConnection</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;driver&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;mysql&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;host&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;localhost&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;database&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;database&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;username&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;root&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;password&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;password&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;charset&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;utf8&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;collation&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;utf8_unicode_ci&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;prefix&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token variable">$capsule</span><span class="token operator">-&gt;</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create Database Adapter instance</span>
<span class="token variable">$adapter</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseAdapter</span><span class="token punctuation">(</span>
    <span class="token argument-name">filesTable</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">&#39;files&#39;</span><span class="token punctuation">,</span>
    <span class="token argument-name">contentsTable</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">&#39;files_contents&#39;</span><span class="token punctuation">,</span>
    <span class="token argument-name">connection</span><span class="token punctuation">:</span> <span class="token variable">$connection</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Finally, create filesystem instance</span>
<span class="token variable">$filesystem</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Filesystem</span><span class="token punctuation">(</span><span class="token variable">$adapter</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1);function _(x,S){const t=l("router-link"),p=l("ExternalLinkIcon");return i(),u("div",null,[k,d,n("nav",v,[n("ul",null,[n("li",null,[a(t,{to:"#inside-laravel-application"},{default:e(()=>[s("Inside Laravel Application")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#register-service-provider"},{default:e(()=>[s("Register Service Provider")]),_:1})]),n("li",null,[a(t,{to:"#create-custom-migration"},{default:e(()=>[s("Create custom migration")]),_:1})]),n("li",null,[a(t,{to:"#add-storage-disk-profile"},{default:e(()=>[s('Add storage disk "profile"')]),_:1})]),n("li",null,[a(t,{to:"#use-storage-disk"},{default:e(()=>[s("Use storage disk")]),_:1})])])]),n("li",null,[a(t,{to:"#outside-laravel"},{default:e(()=>[s("Outside Laravel")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#sqlite"},{default:e(()=>[s("SQLite")]),_:1})]),n("li",null,[a(t,{to:"#mysql-mariadb"},{default:e(()=>[s("MySQL / MariaDB")]),_:1})]),n("li",null,[a(t,{to:"#postgresql"},{default:e(()=>[s("PostgreSQL")]),_:1})]),n("li",null,[a(t,{to:"#sql-server"},{default:e(()=>[s("SQL Server")]),_:1})]),n("li",null,[a(t,{to:"#new-adapter-instance"},{default:e(()=>[s("New Adapter Instance")]),_:1})])])])])]),g,n("p",null,[s("See "),n("a",m,[s("Laravel documentation"),a(p)]),s(" for additional examples on how to use custom disk profiles.")]),b,n("p",null,[s("The database adapter uses "),n("a",y,[s("Laravel's Database package"),a(p)]),s(" as means of performing queries. This means that you will need to establish a connection to your database, using Laravel's connection "),q,s(". But before you do that, you will need to create appropriate table schema required by the adapter.")]),h,n("p",null,[s("Depending on your database, a different configuration will be required. You can find available connection configuration in "),n("a",w,[s("Laravel's example configuration file"),a(p)]),s(".")]),f])}const A=c(r,[["render",_],["__file","setup.html.vue"]]);export{A as default};
